<link rel="stylesheet" href="$celementsweb.getSkinFile(':celRes/galleryEdit.css', 'file')" type="text/css" media="screen" />
#if("$!request.get('xredirect')" != '')
#set($xredirect = $!request.getParameter('xredirect'))
#else
#set($xredirect = "$doc.getURL('view')")
#end
#set($redirectStr = "xredirect=$xredirect")
#set($filled = $request.get("submitted") == "1")
#set($complete = true)
#set($valid = true)
#if($filled && $complete && $valid)
 ## set album title
 $doc.setTitle($!request.get("title"))
 #set($pagetype_obj = $doc.getObject("Celements2.PageType"))
 #if(!$pagetype_obj)
  #set($pagetype_obj = $doc.newObject("Celements2.PageType"))
  $pagetype_obj.set("page_type", "Gallery")
 #end
 ## create album object
 #set($album_obj = $doc.getObject("XWiki.PhotoAlbumClass"))
 #if(!$album_obj)
  #set($album_obj = $doc.newObject("XWiki.PhotoAlbumClass"))
 #end
 #if("$!album_obj.getProperty('id').getValue()" == '')
   #set($allGalleries = $services.query.getXWQL("from doc.object('XWiki.PhotoAlbumClass') as album order by album.id desc").execute())
   #set($nextId = 0)
   #if($allGalleries.size() > 0))
     #set($lastGalDoc = $xwiki.getDocument($allGalleries.get(0)))
     #set($lastGalObj = $lastGalDoc.getObject('XWiki.PhotoAlbumClass'))
     #if("$!lastGalObj.get('id')" != '')
       #set($nextId = $xwiki.parseInt($lastGalObj.get('id')) + 1)
     #end
   #end
   $album_obj.set('id', $nextId)
 #end
 $album_obj.set("thumbWidth", $!request.get("thumbWidth"))
 $album_obj.set("height", $!request.get("height"))
 $album_obj.set("height2", $!request.get("height2"))
 $album_obj.set("photoWidth", $!request.get("photoWidth"))
 $album_obj.set("description", $!request.get("description"))
 $album_obj.set('hasOverview',$!request.get('XWiki.PhotoAlbumClass_0_hasOverview'))
 $album_obj.set('thumbDescription',$!request.get('thumbDescription'))
 $album_obj.set('theme',$!request.get('XWiki.PhotoAlbumClass_0_theme'))
 $doc.save()
 ## redirect to edit album
 $context.getResponse().sendRedirect($doc.getURL("view"))
#end
<div class="celements2_box editGallery_box c3_scrollable">
  #set($title = $!doc.getTitle())
<div class="celements2_box_title">$adminMsg.get('gallery_edit_gallery') #if("$!doc.getTitle()" != '')${doc.getTitle()}#else${doc.getName()}#end</div>
<div class="celements2_box_subtitle">$adminMsg.get('gallery_gallery_properties')</div>
$celementsweb.addExtJSfileOnce(':celJS/prototype.js')
$celementsweb.addExtJSfileOnce(':celJS/validation.js')
<form id="edit" method="post" action="$xwiki.getURL($doc.getFullName(), 'save')" target="_parent">
  <input type="hidden" name="template" value="$!doc.getTemplate()" />
  <input type="hidden" name="xredirect" value="$!xredirect" />
  <input type="hidden" name="language" value="$!tdoc.language" />
 <input type="hidden" class="celEditorRedirect" name="xredirect" value="$xredirect" />
<input type="hidden" name="submitted" value="1" />
#set($albumobj = $!doc.getObject("XWiki.PhotoAlbumClass"))
<table cellspacing="0" cellpadding="0" border="0" class="celements2_table">
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_album_title')</td>
  #set($title = $!doc.getTitle())
 <td><input name="title" type="text" value="$!title" class="celements2_input" /></td>
</tr>
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_album_description')</td>
 <td><textarea name="description" class="celements2_input">$!albumobj.getProperty("description").getValue()</textarea></td>
</tr>
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_with_overview')</td>
    #set($pretagFixStr = '')
    #set($pretagFixStr = $!doc.display('hasOverview','edit',$albumobj))
 <td>${pretagFixStr.replaceAll('\{/?pre\}','')}</td>
</tr>
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_thumbnail_width')</td>
 <td><input name="thumbWidth" type="text" value="$!albumobj.getProperty("thumbWidth").getValue()" class="celements2_input validate-number" /></td>
</tr>
 <td class="celements2_text">$adminMsg.get('gallery_thumbnail_height')</td>
 <td><input name="height" type="text" value="$!albumobj.getProperty("height").getValue()" class="celements2_input validate-number" /></td>
</tr>
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_picture_height')</td>
 <td><input name="height2" type="text" value="$!albumobj.getProperty("height2").getValue()" class="celements2_input validate-number" /></td>
</tr>
<tr>
 <td class="celements2_text">$adminMsg.get('gallery_picture_width')</td>
 <td><input name="photoWidth" type="text" value="$!albumobj.getProperty("photoWidth").getValue()" class="celements2_input validate-number" /></td>
</tr>

<tr class="galleryDescriptionEdit">
 <td class="celements2_text">$adminMsg.get('gallery_thumbnail_desc')</td>
<td><input name="thumbDescription" type="checkbox" ##
 #if("$!albumobj.getProperty('thumbDescription').getValue()" == '1')
   checked="checked" ##
 #end
  value="1" class="celements2_input" /></td>
</tr>

<tr class="galleryDescriptionEdit">
 <td colspan="2">
#set($cel_editobj_dict_prefix = 'gallery_editor_')
#set($cel_editobj_externalForm = true)  
#set($cel_embedded_editobj = true)
#set($cel_editobj_title = $adminMsg.get('gallery_gallery_properties'))
#set($cel_editobj_hasObjAddLink = false)
#set($cel_editobj_hasObjRemoveLink = false)
#set($cel_editobj_classname = "XWiki.PhotoAlbumClass")
#set($cel_editobj_nb = $albumobj.getNumber())
#set($cel_editobj_properties = "theme")
 $xwiki.includeForm('celements2web:Templates.ObjectEdit',false)</td>
</tr>


</table>
  <div id="editablecode_container">
  #set($cel_embedded_editobj = true)
  #set($cel_editobj_classname = "Celements2.NavigationConfigClass")
  #set($cel_editobj_nb = $navObj.getNumber())
  #set($cel_editobj_hasObjRemoveLink = false)
  #set($cel_editobj_externalForm = true)
  #set($cel_editobj_properties = "menu_space")
  #if(!$isAdmin)
    #set($cel_editobj_readonly_properties = 'menu_space')
  #end
  $xwiki.parseTemplate("celTemplates/ObjectEdit.vm")
  </div>
  <div>
    <h1>$adminMsg.get('cel_presentation_reordering_title')</h1>
    <p>$adminMsg.get('cel_presentation_reordering_hint')</p>
    <button class="cel_naveditor_button_cancel">$adminMsg.get('cel_cancel')</button>
    <button class="cel_naveditor_button_saveAndContinue">$adminMsg.get('cel_save')</button>
  </div>
  <div id="cel_presentation_editor_reorder_tree" class="presentation_order_edit">
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/yahoo/yahoo-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/event/event-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/yahoo-dom-event/yahoo-dom-event.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/dom/dom-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/element/element-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/connection/connection-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/json/json-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/dragdrop/dragdrop-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/element/element-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/button/button-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/container/container-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/utilities/utilities.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/yui/animation/animation-min.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/navigation/reorderMenuItems.js</span>
<span class='cel_lazyloadJS' style='display: none;'>celJS/celpresentation/reorder.js</span>
$celementsweb.addExtJSfileOnce(':celJS/yui/yahoo/yahoo-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/event/event-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/yahoo-dom-event/yahoo-dom-event.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/dom/dom-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/element/element-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/connection/connection-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/json/json-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/dragdrop/dragdrop-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/element/element-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/button/button-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/container/container-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/utilities/utilities.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/yui/animation/animation-min.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/navigation/reorderMenuItems.js', 'file')
$celementsweb.addExtJSfileOnce(':celJS/celpresentation/reorder.js', 'file')
#set($structNav = $celementsweb.createNavigation())
$structNav.setMenuPart("")
##$structNav.setShowAll(true)
$structNav.setShowInactiveToLevel(1)
$structNav.setHasLink(false)
$structNav.setPresentationType('sitemap')
$structNav.setMenuSpace($navObj.getProperty('menu_space').getValue())
$structNav.addUlCSSClass("cel_presentation_reorder")
$structNav.setCMcssClass("cel_cm_presentationeditor_nodes")
$structNav.includeNavigation()
  </div>
</form>
<script type="text/javascript">
 var valid = new Validation('edit', {immediate : true});
 ## if not complete or valid run the js validation
 #if($filled && (!$complete || !$valid))
 var result = valid.validate();
 #end
</script>
</div>